---
import { getSEOMetadata } from '../utils/seo';

const { 
    finalTitle, 
    finalDesc, 
    finalImage, 
    canonicalURL 
} = getSEOMetadata(Astro.props, Astro.url, Astro.site);
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" href="/favicon.ico" />

        <!-- SEO and Open Graph -->
        <title>{finalTitle}</title>
        <meta name="description" content={finalDesc} />

        <meta property="og:type" content="article" />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={finalTitle} />
        <meta property="og:description" content={finalDesc} />
        <meta property="og:image" content={finalImage} />

        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="/favicon-16x16.png"
        />
        <link rel="manifest" href="/site.webmanifest" />
    </head>
    <body>
        <main>
            <header>
                <a href="/">[home]</a>
                <a href="https://github.com/apparentlyarhm">[github]</a>
                <a href="https://arhm.dev">[portfolio]</a>
                <a href="mailto:mohd.arhum28@gmail.com">[reach out]</a>
            </header>
            <hr />

            <slot />

            <hr />
            <footer>
                <small>server: go // builder: astro // ui: plain text</small>
            </footer>
        </main>
    </body>
</html>

<style is:global>
    /* inspired by https://fonts.google.com/knowledge/using_type/the_foundations_of_web_typography */

    @font-face {
        font-family: "JetBrains Mono";
        src: url("/fonts/JetBrainsMono[wght].ttf") format("truetype");
        font-weight: 100 800;
        font-style: normal;
        font-display: swap;
    }
    img {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        display: block;
        margin: 2rem auto;
        cursor: pointer;
    }

    :root {
        --bg: #111111;
        --fg: #eeeeee;
        --accent: #00ff00;

        --text-base: 1.125rem;
        --text-lg: 1.414rem;
        --text-xl: 1.999rem;
        --text-2xl: 2.827rem;
    }

    html {
        font-family: "JetBrains Mono", monospace; /* Fallback */
        background: var(--bg);
        color: var(--fg);

        font-size: clamp(100%, 1vw + 1rem, 1.2rem);
    }

    hr {
        border: none;
        border-top: 1px solid #333;
        margin: 2rem 0;
        padding: 2px;
    }

    body {
        margin: 0;
        padding: 2rem 1.5rem; /* More padding on mobile */
        max-width: 90ch;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.7;
    }

    h1,
    h2,
    h3 {
        /* font-family: 'Space Grotesk', sans-serif; */
        color: #fff;
        font-weight: 600;
        line-height: 1.2;
        letter-spacing: -0.02em;
        text-align: left;
    }

    h1 {
        font-size: var(--text-2xl);
        margin-top: 0;
        margin-bottom: 1.5rem;
    }

    h2 {
        font-size: var(--text-xl);
        /* PROXIMITY RULE: More space above, less below */
        margin-top: 3.5rem;
        margin-bottom: 0.75rem;

        border-bottom: 1px dashed #333;
        display: inline-block;
        padding-bottom: 0.2rem;
    }

    h3 {
        font-size: var(--text-lg);
        margin-top: 2.5rem;
        margin-bottom: 0.5rem;
    }

    p {
        margin-bottom: 1.5rem;
        color: #8b8b8b;
    }

    a {
        color: var(--fg);
        text-decoration-thickness: 1px;
        text-underline-offset: 4px; /* Pushes underline down for legibility */
        transition: all 0.2s ease;
    }

    a:hover {
        color: var(--accent);
        background: #1a1a1a;
        text-decoration: none;
    }

    ul,
    ol {
        padding-left: 1.5rem;
        margin-bottom: 1.5rem;
    }

    li {
        margin-bottom: 0.5rem;
        padding-left: 0.5rem;
        color: #8b8b8b;
    }

    li::marker {
        color: #666;
    }

    :not(pre) > code {
        font-family: "JetBrains Mono", monospace;
        padding: 0.2em 0.4em;
        background: #2a2a2a;
        color: #ff79c6;
        border-radius: 4px;
        font-size: 0.85em;
        border: 1px solid #333;
    }

    pre {
        background-color: #0d1117 !important; /* override shiki */
        padding: 1.5rem;
        border: 1px solid #30363d; /* Subtle border matching the theme */
        border-radius: 12px;
        font-size: 0.9rem;
        line-height: 1.6;
        margin: 2rem 0;
    }

    /* This forces the code INSIDE the block to be transparent and unstyled 
       so the syntax highlighting shines through */
    pre code {
        background: transparent !important;
        color: inherit !important;
        padding: 0 !important;
        border: none !important;
        border-radius: 0 !important;
        font-size: inherit !important;
        overflow-x: auto !important;
    }

    footer {
        text-align: left;
        font-size: 0.8em;
        color: #333333;
    }

    /* used gemini to give me a good mobile adaptation */

    /* ========================================= */
    /*  MOBILE OPTIMIZATIONS (Max Width 768px) */
    /* ========================================= */
    @media (max-width: 768px) {
        :root {
            /* 1. Downscale the Typography Hierarchy */
            /* We drop the ratio to be tighter on mobile */
            --text-base: 1rem; /* 16px (Standard readability) */
            --text-lg: 1.25rem; /* ~20px */
            --text-xl: 1.5rem; /* ~24px */
            --text-2xl: 1.85rem; /* ~30px (Much smaller than desktop 45px) */
        }

        img {
            border-radius: 4px; /* Smaller radius for small screens */
            margin: 1.5rem auto;
        }

        html {
            /* Reset fluid type - stick to base size on mobile to prevent "Huge Text" syndrome */
            font-size: 16px;
        }

        body {
            /* 2. Reclaim Screen Real Estate */
            padding: 1.5rem 1rem; /* Less padding on sides */
            max-width: 100%;
        }

        h1 {
            margin-bottom: 1rem;
        }

        h2 {
            /* Tighten vertical rhythm (scrolling is expensive on mobile) */
            margin-top: 2.5rem;
            margin-bottom: 0.5rem;
        }

        pre {
            padding: 1rem;
            margin: 1.5rem -1rem; /* Pull to edges */
            border-radius: 0;
            border-left: none;
            border-right: none;
            overflow-x: auto !important;
        }

        pre code {
            white-space: pre; /* or pre-nowrap */
            word-break: normal;
        }

        /* Ensure inline code doesn't break layout */
        code {
            font-size: 0.9rem;
        }
    }
</style>
